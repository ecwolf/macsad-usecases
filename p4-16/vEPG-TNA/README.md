# TNA Version vEPG Code

This directory hosts P4 implementation of virtual Evolved Packet Gateway (vEPG) running on the Barefoot Tofino programmable switch.
User Plane Functions of vEPG Uplink (vEPG-UL) and vEPG Downlink (vEPG-DL) are shown in given figure below:

<img src="Figures/UserPlaneFunctions.png" alt="alt text" width="300" height="270"> 

## vEPG Pipeline:

<img src="Figures/vEPG_Pipeline.png" alt="alt text" width="300" height="270"> 

vEPG_TNA folder contains two sub-folders: vEPG_P4_TNA and vEPG_Optimization_P4_TNA.
Inside vEPG_P4_TNA, we can get the complete TNA P4 code for vEPG-UL and vEPG-DL which we used for performance evaluation. vEPG_Optimization_P4_TNA is used for optimization. In the optimization code, the user device IP lookup is performed with an action to set the TEID and destination IP (i.e. eNB address) for downlink sessions, whereas the remaining actions are executed independently. Under this arrangement, the GTP Encap table becomes narrower and can scale up to 850k UDs.

## Testbed:

Figure shows the testbed featuring Open Source Network Tester (OSNT) as the traffic generator using NetFPGA-SUME with 10G SFP+ interfaces connected to the device under test (DUT), in our case (1) Edgecore Wedge 100BF-32X with Barefoot Tofino ASIC5, or (2) x86 server with Intel Xeon D-1518 processor (4 CPU cores, Cache 6M, 2,20 GHz) for the vEPG application generated by the MACSAD compiler for ODP-DPDK x86 targets.

<img src="Figures/Testbed.png" alt="alt text" width="300" height="270"> 

## Compiling:
